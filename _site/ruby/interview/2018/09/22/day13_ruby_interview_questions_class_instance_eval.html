<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>30å¤©ä¿®ç…‰Rubyé¢è©¦ç²¾é¸30é¡Œ - Day13 instance_eval å’Œ class_eval çš„å·®åˆ¥ | Tingâ€™s Square.</title>
<meta name="generator" content="Jekyll v3.8.3" />
<meta property="og:title" content="30å¤©ä¿®ç…‰Rubyé¢è©¦ç²¾é¸30é¡Œ - Day13 instance_eval å’Œ class_eval çš„å·®åˆ¥" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="ç¬¬13å¤©! æ˜¨å¤©è«‡åˆ°äº†class variable, class instance variableå’Œinstance variableï¼Œä¹Ÿç™¼ç¾åœ¨å¯¦å‹™ä¸Šï¼Œé¡åˆ¥å¯¦é«”è®Šæ•¸å’Œå¯¦é«”è®Šæ•¸æ‰æ˜¯ä¸»æµã€‚ä»Šå¤©æˆ‘å€‘è¦å¤šè«‡å…©å€‹è·Ÿå‰ä¸€ç¯‡çš„è®Šæ•¸æœ‰é—œçš„æ–¹æ³•:instance_evalå’Œclass_evalã€‚è®“æ¯å¤©éƒ½ä¸»é¡Œéƒ½ç’°ç’°ç›¸æ‰£ï¼" />
<meta property="og:description" content="ç¬¬13å¤©! æ˜¨å¤©è«‡åˆ°äº†class variable, class instance variableå’Œinstance variableï¼Œä¹Ÿç™¼ç¾åœ¨å¯¦å‹™ä¸Šï¼Œé¡åˆ¥å¯¦é«”è®Šæ•¸å’Œå¯¦é«”è®Šæ•¸æ‰æ˜¯ä¸»æµã€‚ä»Šå¤©æˆ‘å€‘è¦å¤šè«‡å…©å€‹è·Ÿå‰ä¸€ç¯‡çš„è®Šæ•¸æœ‰é—œçš„æ–¹æ³•:instance_evalå’Œclass_evalã€‚è®“æ¯å¤©éƒ½ä¸»é¡Œéƒ½ç’°ç’°ç›¸æ‰£ï¼" />
<link rel="canonical" href="http://localhost:4000/ruby/interview/2018/09/22/day13_ruby_interview_questions_class_instance_eval.html" />
<meta property="og:url" content="http://localhost:4000/ruby/interview/2018/09/22/day13_ruby_interview_questions_class_instance_eval.html" />
<meta property="og:site_name" content="Tingâ€™s Square." />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-09-22T08:15:00+10:00" />
<script type="application/ld+json">
{"description":"ç¬¬13å¤©! æ˜¨å¤©è«‡åˆ°äº†class variable, class instance variableå’Œinstance variableï¼Œä¹Ÿç™¼ç¾åœ¨å¯¦å‹™ä¸Šï¼Œé¡åˆ¥å¯¦é«”è®Šæ•¸å’Œå¯¦é«”è®Šæ•¸æ‰æ˜¯ä¸»æµã€‚ä»Šå¤©æˆ‘å€‘è¦å¤šè«‡å…©å€‹è·Ÿå‰ä¸€ç¯‡çš„è®Šæ•¸æœ‰é—œçš„æ–¹æ³•:instance_evalå’Œclass_evalã€‚è®“æ¯å¤©éƒ½ä¸»é¡Œéƒ½ç’°ç’°ç›¸æ‰£ï¼","@type":"BlogPosting","url":"http://localhost:4000/ruby/interview/2018/09/22/day13_ruby_interview_questions_class_instance_eval.html","headline":"30å¤©ä¿®ç…‰Rubyé¢è©¦ç²¾é¸30é¡Œ - Day13 instance_eval å’Œ class_eval çš„å·®åˆ¥","dateModified":"2018-09-22T08:15:00+10:00","datePublished":"2018-09-22T08:15:00+10:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/ruby/interview/2018/09/22/day13_ruby_interview_questions_class_instance_eval.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Ting's Square." /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Ting&#39;s Square.</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">30å¤©ä¿®ç…‰Rubyé¢è©¦ç²¾é¸30é¡Œ - Day13 instance_eval å’Œ class_eval çš„å·®åˆ¥ </h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2018-09-22T08:15:00+10:00" itemprop="datePublished">Sep 22, 2018
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>ç¬¬13å¤©! æ˜¨å¤©è«‡åˆ°äº†class variable, class instance variableå’Œinstance variableï¼Œä¹Ÿç™¼ç¾åœ¨å¯¦å‹™ä¸Šï¼Œé¡åˆ¥å¯¦é«”è®Šæ•¸å’Œå¯¦é«”è®Šæ•¸æ‰æ˜¯ä¸»æµã€‚ä»Šå¤©æˆ‘å€‘è¦å¤šè«‡å…©å€‹è·Ÿå‰ä¸€ç¯‡çš„è®Šæ•¸æœ‰é—œçš„æ–¹æ³•:<code class="highlighter-rouge">instance_eval</code>å’Œ<code class="highlighter-rouge">class_eval</code>ã€‚è®“æ¯å¤©éƒ½ä¸»é¡Œéƒ½ç’°ç’°ç›¸æ‰£ï¼</p>

<hr />

<h1 id="rubyç¶“å…¸é¢è©¦é¡Œç›®-13">Rubyç¶“å…¸é¢è©¦é¡Œç›® #13</h1>

<p><code class="highlighter-rouge">instance_eval å’Œ class_eval çš„å·®åˆ¥ ? What's the difference between instance_eval and class_eval?</code></p>

<p>ç”±éå»å¹¾å¤©çš„å¯«ä½œç¶“é©—ï¼Œæˆ‘ç™¼ç¾ä¸€ç¯‡æ–‡ç« çš„é–‹é ­æœ€é›£ä¸‹ç­†ã€ä¹Ÿæ˜¯æœ€é‡è¦çš„ï¼Œèˆ‰ä¾‹ğŸŒ°èƒ½è®“è‡ªå·±æ‡‚ï¼ˆ<del>é‚„æœ‰è®“æˆ‘çš„è®€è€…ã€è§€çœ¾ã€åŠ æ²¹ç¾¤å•¦å•¦éšŠæ‡‚</del>ï¼‰æ›´ä¸æ˜¯å®¹æ˜“çš„äº‹ã€‚æ­¤ç¯‡æ–‡ç« ç”±å¯¦é«”è®Šæ•¸é–‹å§‹æœƒèƒ½å¤ å¾ªåºæ¼¸é€²ï¼Œæ‰€ä»¥å°±å¾<code class="highlighter-rouge">instance_eval</code>åˆ‡å…¥å§ï¼</p>

<h2 id="instance_eval">instance_eval</h2>

<p>æ˜¨å¤©æ–‡ç« æåˆ°ä¸€å€‹é‡è¦æ¦‚å¿µï¼šèƒ½å¤ è®€å–è®Šæ•¸çš„å±¬æ€§æ˜¯éå¸¸é‡è¦çš„ï¼Œè®“æˆ‘å€‘å¯ä»¥æ›´æ–¹ä¾¿çš„è®€å–åç¨±ç›¸åŒï¼Œä½†å…¶å¯¦å€¼ä¸åŒçš„ç‰©ä»¶ã€‚</p>

<p>è®“æˆ‘å€‘æŠŠæ˜¨å¤©çš„<code class="highlighter-rouge">attr_accessor</code>æ¦‚å¿µå¼•å…¥ï¼Œé¦¬ä¸Šä¾†å¯«ç¨‹å¼ç¢¼å¯¦é©—<code class="highlighter-rouge">instance_eval</code>ï¼š</p>

<h3 id="instance_evalæ¡ˆä¾‹1attr_accessor">[instance_evalæ¡ˆä¾‹1:attr_accessor]</h3>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">RunMarathon</span>
 <span class="nb">attr_accessor</span> <span class="ss">:km</span>
<span class="k">end</span>

<span class="n">hm</span> <span class="o">=</span> <span class="no">RunMarathon</span><span class="p">.</span><span class="nf">new</span>
<span class="n">hm</span><span class="p">.</span><span class="nf">km</span> <span class="o">=</span> <span class="mi">21</span>

<span class="n">fm</span> <span class="o">=</span> <span class="no">RunMarathon</span><span class="p">.</span><span class="nf">new</span>
<span class="n">fm</span><span class="p">.</span><span class="nf">km</span> <span class="o">=</span> <span class="mi">42</span>

<span class="nb">p</span> <span class="n">hm</span>
<span class="nb">p</span> <span class="n">fm</span>
<span class="nb">p</span> <span class="n">hm</span><span class="p">.</span><span class="nf">km</span>
<span class="nb">p</span> <span class="n">fm</span><span class="p">.</span><span class="nf">km</span>

<span class="nb">p</span> <span class="n">hm</span><span class="p">.</span><span class="nf">instance_eval</span> <span class="p">{</span> <span class="vi">@km</span> <span class="p">}</span> <span class="c1"># 21 å’Œhm.kmçš„çµæœç›¸åŒ</span>
<span class="nb">p</span> <span class="n">fm</span><span class="p">.</span><span class="nf">instance_eval</span> <span class="p">{</span> <span class="vi">@km</span> <span class="p">}</span> <span class="c1"># 42 å’Œfm.kmçš„çµæœç›¸åŒ</span>

<span class="nb">p</span> <span class="no">RunMarathon</span><span class="p">.</span><span class="nf">instance_methods</span><span class="p">(</span><span class="kp">false</span><span class="p">)</span> <span class="c1">#[:km=, :km]</span>
</code></pre></div></div>

<p>æˆ‘å€‘å‰µäº†<code class="highlighter-rouge">RunMarathon</code>é¡åˆ¥ï¼Œnewå‡ºå…©å€‹ç‰©ä»¶<code class="highlighter-rouge">hm</code>åŠç¨‹é¦¬æ‹‰æ¾å’Œ<code class="highlighter-rouge">fm</code>å…¨ç¨‹é¦¬æ‹‰æ¾ä¸¦å„è‡ªæŒ‡å®šå°æ‡‰çš„<code class="highlighter-rouge">km</code>å…¬é‡Œæ•¸å€¼ã€‚é€™è£¡ç”¨åˆ°å…©å€‹<code class="highlighter-rouge">instance_methods</code>å¯¦é«”æ–¹æ³•<code class="highlighter-rouge">km=</code>(å¯«å…¥å€¼)å’Œ<code class="highlighter-rouge">km</code>(è®€å‡ºå€¼)ã€‚å†ç”¨<code class="highlighter-rouge">.instance_eval</code>é¡¯ç¤ºå€¼ã€‚çµæœå°å‡ºï¼š</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#&lt;RunMarathon:0x000055f60ed4f0d0 @km=21&gt;</span>
<span class="c1">#&lt;RunMarathon:0x000055f60ed4f0a8 @km=42&gt;</span>
<span class="mi">21</span>
<span class="mi">42</span>
<span class="mi">21</span>
<span class="mi">42</span>
<span class="p">[</span><span class="ss">:km</span><span class="o">=</span><span class="p">,</span> <span class="ss">:km</span><span class="p">]</span>
</code></pre></div></div>

<p>å¾ˆå¥½ï¼æˆåŠŸç”¨<code class="highlighter-rouge">instance_eval</code>å°å‡ºå€¼äº†ï¼</p>

<h3 id="instance_evalæ¡ˆä¾‹2-åªç”¨initializeæ–¹æ³•">[instance_evalæ¡ˆä¾‹2: åªç”¨initialize()æ–¹æ³•]</h3>

<p>å¦‚æœæˆ‘å€‘æŠŠç¨‹å¼ç¢¼æ”¹ç‚ºåœ¨<code class="highlighter-rouge">RunMarathon</code>é¡åˆ¥åŠ å…¥<code class="highlighter-rouge">initialize()</code>æ–¹æ³•ï¼Œè®“æˆ‘å€‘åœ¨newå‡ºç‰©ä»¶çš„åŒæ™‚å‚³å…¥å…¬é‡Œæ•¸ï¼Œç¨‹å¼ç¢¼è®Šæˆå¦‚ä¸‹ï¼š</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">RunMarathon</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">km</span><span class="p">)</span>
    <span class="vi">@km</span> <span class="o">=</span> <span class="n">km</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">km</span>
    <span class="vi">@km</span>
  <span class="k">end</span>  
<span class="k">end</span>

<span class="n">hm</span> <span class="o">=</span> <span class="no">RunMarathon</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">21</span><span class="p">)</span>
<span class="n">fm</span> <span class="o">=</span> <span class="no">RunMarathon</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="nb">p</span> <span class="n">hm</span>
<span class="nb">p</span> <span class="n">fm</span>
<span class="nb">p</span> <span class="n">hm</span><span class="p">.</span><span class="nf">km</span>
<span class="nb">p</span> <span class="n">fm</span><span class="p">.</span><span class="nf">km</span>

<span class="nb">p</span> <span class="n">hm</span><span class="p">.</span><span class="nf">instance_eval</span> <span class="p">{</span> <span class="vi">@km</span> <span class="p">}</span> <span class="c1"># 21 å’Œhm.kmçš„çµæœç›¸åŒ</span>
<span class="nb">p</span> <span class="n">fm</span><span class="p">.</span><span class="nf">instance_eval</span> <span class="p">{</span> <span class="vi">@km</span> <span class="p">}</span> <span class="c1"># 42 å’Œfm.kmçš„çµæœç›¸åŒ</span>

<span class="nb">p</span> <span class="no">RunMarathon</span><span class="p">.</span><span class="nf">instance_methods</span><span class="p">(</span><span class="kp">false</span><span class="p">)</span> <span class="c1">#[:km]</span>
</code></pre></div></div>

<p>æˆ‘å€‘å¯ä»¥å¾<code class="highlighter-rouge">.instance_methods</code>çœ‹åˆ°æ–¹æ³•åªå‰©ä¸‹è®€å–<code class="highlighter-rouge">:km</code>ï¼Œå¦ä¸€å€‹å¯¦é«”æ–¹æ³•<code class="highlighter-rouge">k=</code>å·²ç¶“ä¸è¦‹äº†ï¼š</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#&lt;RunMarathon:0x000055c2a0e3eac8 @km=21&gt;</span>
<span class="c1">#&lt;RunMarathon:0x000055c2a0e3eaa0 @km=42&gt;</span>
<span class="mi">21</span>
<span class="mi">42</span>
<span class="p">[</span><span class="ss">:km</span><span class="p">]</span>
</code></pre></div></div>

<p>ä»¥ä¸Šè§€å¿µæ˜¯æŠŠæ˜¨å¤©+ä»Šå¤©çš„ä¸€èµ·æ•´åˆè¤‡ç¿’ã€‚</p>

<h3 id="instance_evalæ¡ˆä¾‹3-åªç”¨initializeæ–¹æ³•ä½†å°‡def-kmæ–¹æ³•åˆªé™¤">[instance_evalæ¡ˆä¾‹3: åªç”¨initialize()æ–¹æ³•ï¼Œä½†å°‡<code class="highlighter-rouge">def km</code>æ–¹æ³•åˆªé™¤]</h3>

<p>å¦‚æœï¼Œæˆ‘å€‘æŠŠ<code class="highlighter-rouge">RunMarathon</code>classçš„å®šç¾©å…¬é‡Œè®Šæ•¸æ–¹æ³•:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">km</span>
    <span class="vi">@km</span>
<span class="k">end</span>  
</code></pre></div></div>

<p>ç§»é™¤ï¼Œæœƒç™¼ç”Ÿä»€éº¼äº‹å‘¢ï¼Ÿ</p>

<p>ï¼ˆæˆ‘æƒ³ä½ æ‡‰è©²çŒœåˆ°äº†ï¼Œè·Ÿ<code class="highlighter-rouge">hm.km</code>å’Œ<code class="highlighter-rouge">hm.fm</code>æœ‰é—œï¼šï¼‰</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">RunMarathon</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">km</span><span class="p">)</span>
    <span class="vi">@km</span> <span class="o">=</span> <span class="n">km</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">hm</span> <span class="o">=</span> <span class="no">RunMarathon</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">21</span><span class="p">)</span>
<span class="n">fm</span> <span class="o">=</span> <span class="no">RunMarathon</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="nb">p</span> <span class="n">hm</span>
<span class="nb">p</span> <span class="n">fm</span>
<span class="c1">#p hm.km #undefined method `km' (NoMethodError)</span>
<span class="c1">#p fm.km #undefined method `km' (NoMethodError)</span>

<span class="nb">p</span> <span class="n">hm</span><span class="p">.</span><span class="nf">instance_eval</span> <span class="p">{</span> <span class="vi">@km</span> <span class="p">}</span>
<span class="nb">p</span> <span class="n">fm</span><span class="p">.</span><span class="nf">instance_eval</span> <span class="p">{</span> <span class="vi">@km</span> <span class="p">}</span>

<span class="nb">p</span> <span class="no">RunMarathon</span><span class="p">.</span><span class="nf">instance_methods</span><span class="p">(</span><span class="kp">false</span><span class="p">)</span> <span class="c1">#[]</span>
</code></pre></div></div>

<p>æ²’æœ‰æ–¹æ³•äº†ã€‚<code class="highlighter-rouge">hm.km</code>å’Œ<code class="highlighter-rouge">hm.fm</code>æ‰¾ä¸åˆ°æ–¹æ³•(NoMethodError)ã€‚æˆ‘å€‘ç”¨è¨»è§£<code class="highlighter-rouge">#</code>æ¶ˆå»ç„¡ç”¨çš„é€™å…©è¡Œã€‚</p>

<p>ç„¶è€Œ<code class="highlighter-rouge">.instance_eval</code>å¦‚å¾€å¸¸ä¸€æ¨£å …å®ˆå´—ä½å¹«æˆ‘å€‘å°å‡ºå€¼ã€‚
è€Œ<code class="highlighter-rouge">.instance_methods</code>çš„å°å‡ºçµæœé¡¯ç¤ºå‡ºï¼Œæ­¤æ™‚æˆ‘å€‘ä¸¦æ²’æœ‰ç”¨åˆ°ä»»ä½•çš„å¯¦é«”æ–¹æ³•ã€‚</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#&lt;RunMarathon:0x000055cb6e5142f0 @km=21&gt;</span>
<span class="c1">#&lt;RunMarathon:0x000055cb6e5142c8 @km=42&gt;</span>
<span class="mi">21</span>
<span class="mi">42</span>
<span class="p">[]</span>
</code></pre></div></div>

<p>ç‚ºäº†æ›´è¿‘ä¸€æ­¥äº†è§£ï¼Œæˆ‘å»<a href="http://ruby-doc.org/core-2.5.1/Module.html#method-i-class_eval">Ruby-doc.org</a>æŸ¥åˆ°é€™æ®µè©±ï¼š</p>

<blockquote>
  <p><code class="highlighter-rouge">instance_eval</code> evaluates a string containing Ruby source code, or the given block, within the context of the receiver (obj). In order to set the context, the variable self is set to obj while the code is executing, giving the code access to objâ€™s instance variables and private methods. <a href="http://ruby-doc.org/core-2.5.1/BasicObject.html#method-i-instance_eval">å‡ºè™•</a></p>
</blockquote>

<p>æˆ‘ç™¼ç¾<code class="highlighter-rouge">instance_eval</code>ç”¨ä¾†å®šç¾©æ–¼ä»»ä½•çš„object(åŒ…å«classï¼Œå› ç‚ºé¡åˆ¥ä¹Ÿæ˜¯ä¸€ç¨®ç‰©ä»¶)ï¼Œé‚„å¯ä»¥å­˜å–åˆ°ç§æœ‰æ–¹æ³•<code class="highlighter-rouge">private method</code>ï¼ç«‹é¦¬ä¾†å¯«codeç ”ç©¶ä¸€ä¸‹ã€‚</p>

<p>è©±èªªåœ¨æˆ‘å¿ƒæ·±è™•è—äº†ä¸€å€‹äººç”Ÿé¡˜æœ›ï¼šè·‘è¶…ç´šé¦¬æ‹‰æ¾(ultramarathonï¼Œå…¬é‡Œæ•¸è¶…é50ä»¥ä¸Šçš„é¦¬æ‹‰æ¾)ï¼Œå› æ­¤æˆ‘æ±ºå®šæŠŠé€™å€‹å…§å¿ƒç§˜å¯†æ”¾åœ¨<code class="highlighter-rouge">private method</code>è£¡ï¼š</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">RunMarathon</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">km</span><span class="p">)</span>
    <span class="vi">@km</span> <span class="o">=</span> <span class="n">km</span>
  <span class="k">end</span>

  <span class="kp">private</span>
  <span class="k">def</span> <span class="nf">my_resolution</span>
  <span class="s2">"I'm going to run ultrathon </span><span class="si">#{</span><span class="vi">@km</span><span class="si">}</span><span class="s2"> in the future!"</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">um</span> <span class="o">=</span> <span class="no">RunMarathon</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="nb">p</span> <span class="n">um</span>
<span class="nb">p</span> <span class="n">um</span><span class="p">.</span><span class="nf">instance_eval</span> <span class="p">{</span> <span class="vi">@km</span> <span class="p">}</span>
<span class="nb">p</span> <span class="n">um</span><span class="p">.</span><span class="nf">instance_eval</span> <span class="p">{</span> <span class="n">my_resolution</span> <span class="p">}</span>
</code></pre></div></div>

<p>çµæœé¡¯ç¤ºç‚ºï¼š</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#&lt;RunMarathon:0x0000564cf8966b58 @km=100&gt;</span>
<span class="mi">100</span>
<span class="s2">"I'm going to run ultrathon 100 in the future!"</span>
</code></pre></div></div>

<p>åˆ©ç”¨<code class="highlighter-rouge">.instance_eval{private method}</code>æ¢å°‹å…§å¿ƒæ·±è™•ï¼Œå¥½ç†±è¡€çš„äººç”Ÿå®£è¨€å•Šï½</p>

<h2 id="class_eval">class_eval</h2>

<p>å¦‚æœæˆ‘å€‘æƒ³è¦æå–å€¼å¾ˆå¤šæ¬¡ï¼Œåˆä¸æƒ³ä¸€ç›´é‡è¤‡å¯«é€™æ¨£çš„ç¨‹å¼ç¢¼ï¼š</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">p</span> <span class="n">hm</span><span class="p">.</span><span class="nf">instance_eval</span> <span class="p">{</span> <span class="vi">@km</span> <span class="p">}</span> <span class="c1">#å‘Šè¨´æˆ‘åŠé¦¬å…¬é‡Œæ•¸ï¼</span>
<span class="nb">p</span> <span class="n">fm</span><span class="p">.</span><span class="nf">instance_eval</span> <span class="p">{</span> <span class="vi">@km</span> <span class="p">}</span> <span class="c1">#å‘Šè¨´æˆ‘å…¨é¦¬å…¬é‡Œæ•¸ï¼</span>
<span class="nb">p</span> <span class="n">um</span><span class="p">.</span><span class="nf">instance_eval</span> <span class="p">{</span> <span class="vi">@km</span> <span class="p">}</span> <span class="c1">#å‘Šè¨´æˆ‘è¶…é¦¬å…¬é‡Œæ•¸ï¼</span>

</code></pre></div></div>

<p>æˆ‘å€‘å¯ä»¥åŠ å…¥<code class="highlighter-rouge">class_eval</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">RunMarathon</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">km</span><span class="p">)</span>
    <span class="vi">@km</span> <span class="o">=</span> <span class="n">km</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">RunMarathon</span><span class="p">.</span><span class="nf">class_eval</span> <span class="k">do</span> <span class="c1">#æ”¾RunMarathoné¡åˆ¥çš„å¤–é¢ï¼å®šç¾©æ–°çš„é¡åˆ¥æ–¹æ³•</span>
  <span class="k">def</span> <span class="nf">km</span>
    <span class="vi">@km</span> <span class="c1">#é€™å€‹æ˜¯é¡åˆ¥å¯¦é«”è®Šæ•¸å”·ï¼</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">hm</span> <span class="o">=</span> <span class="no">RunMarathon</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">21</span><span class="p">)</span>
<span class="n">fm</span> <span class="o">=</span> <span class="no">RunMarathon</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="nb">p</span> <span class="n">hm</span>
<span class="nb">p</span> <span class="n">fm</span>
<span class="nb">p</span> <span class="n">hm</span><span class="p">.</span><span class="nf">km</span> <span class="c1">#21 èˆ‡hm.instance_eval {@km} å€¼ç›¸åŒ</span>
<span class="nb">p</span> <span class="n">fm</span><span class="p">.</span><span class="nf">km</span> <span class="c1">#42 èˆ‡fm.instance_eval {@km} å€¼ç›¸åŒ</span>


<span class="nb">p</span> <span class="no">RunMarathon</span><span class="p">.</span><span class="nf">instance_methods</span><span class="p">(</span><span class="kp">false</span><span class="p">)</span> <span class="c1">#[:km]</span>
</code></pre></div></div>

<p>ç¨‹å¼ç¢¼é‹è¡Œå¦‚ä¸‹ï¼š</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#&lt;RunMarathon:0x00005619eeb8ec88 @km=21&gt;</span>
<span class="c1">#&lt;RunMarathon:0x00005619eeb8ec60 @km=42&gt;</span>
<span class="mi">21</span>
<span class="mi">42</span>
<span class="p">[</span><span class="ss">:km</span><span class="p">]</span>
</code></pre></div></div>

<p>ç§ï¼æ˜¯ä¸æ˜¯è·Ÿ[<code class="highlighter-rouge">instance_evalæ¡ˆä¾‹2: åªç”¨initialize()æ–¹æ³•</code>]é€™è£¡æ‰€èˆ‰çš„ä¾‹å­ä¸€ã€‚æ¨¡ã€‚ä¸€ã€‚æ¨£ï¼</p>

<p>ç‚ºä»€éº¼</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">RunMarathon</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">km</span><span class="p">)</span>
    <span class="vi">@km</span> <span class="o">=</span> <span class="n">km</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">RunMarathon</span><span class="p">.</span><span class="nf">class_eval</span> <span class="k">do</span> <span class="c1">#æ”¾å¤–é¢ï¼å®šç¾©é¡åˆ¥æ–¹æ³•</span>
  <span class="k">def</span> <span class="nf">km</span>
    <span class="vi">@km</span> <span class="c1">#é€™å€‹æ˜¯é¡åˆ¥å¯¦é«”è®Šæ•¸å”·ï¼</span>
  <span class="k">end</span>
<span class="k">end</span>

</code></pre></div></div>

<p>å’Œ</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">RunMarathon</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">km</span><span class="p">)</span>
    <span class="vi">@km</span> <span class="o">=</span> <span class="n">km</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">km</span>
    <span class="vi">@km</span>
  <span class="k">end</span>  
<span class="k">end</span>
</code></pre></div></div>

<p>æœƒå‡ºç¾ç›¸åŒçš„çµæœå‘¢ï¼Ÿ</p>

<p>æˆ‘åœ¨<a href="http://web.stanford.edu/~ouster/cgi-bin/cs142-winter15/classEval.php">å²ä¸¹ä½›å¤§å­¸CS142èª²ç¨‹</a>é€™ç¯‡æ•™ææ‰¾åˆ°è§£ç­”:</p>

<blockquote>
  <p>class_eval is equivalent to typing the code inside a class statement.</p>
</blockquote>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">MyClass</span><span class="p">.</span><span class="nf">class_eval</span> <span class="k">do</span>
  <span class="k">def</span> <span class="nf">num</span>
    <span class="vi">@num</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>ç­‰æ–¼</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">MyClass</span>
  <span class="k">def</span> <span class="nf">num</span>
    <span class="vi">@num</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>æ‰€ä»¥å›åˆ°ä»Šå¤©æœ€ä¸€é–‹é ­çš„èˆ‰ä¾‹ [instance_evalæ¡ˆä¾‹1:æ¡ˆä¾‹2:æ¡ˆä¾‹3]ï¼Œé€éç§»é™¤éƒ¨åˆ†çš„ç¨‹å¼ç¢¼åšå¯¦é©—ï¼Œå¾instance_evalï¼Œä¸²åˆ°class_evalï¼Œå†ä¸²å›åˆ°instance_evalï¼Œå¥½åƒåˆå›åˆ°åˆè¡·ã€è±ç„¶é–‹æœ—çš„æ„Ÿè¦ºå‘¢ï¼</p>

<p>æˆ‘ä¹Ÿé ˜æ‚Ÿåˆ°äº†ï¼Œå…¶å¯¦ç¨‹å¼å¯«æ³•éƒ½å¯ä»¥æ›ä¾†æ›å»ï¼Œé‡é»æ˜¯ï¼Œä½ æƒ³å¯¦ç¾çš„åŠŸèƒ½æ˜¯ä»€éº¼ï¼Ÿä¸åŒçš„å¯«æ³•ä¹‹é–“åˆæœ‰ä»€éº¼å„ªç¼ºé»æ¯”è¼ƒï¼Ÿåƒåœ¨<a href="https://blog.hothero.org/2015/08/05/instance-eval-yu--class-eval-chai-yi-/">é€™ç¯‡</a>æåˆ°ï¼šclass_evalæ¦‚å¿µï¼Œè·Ÿmodule_evalæ˜¯é¡ä¼¼çš„ï¼Œæ‹¿ä¾†ç”¨ä½œæ“´å……rails gem æ‰€å®šç¾©çš„ classï¼Œé€™ä¹Ÿè¨±å¯ä»¥ç•¶æˆ‘ç¬¬20å¤©å€™éµäººè³½çš„æ–‡ç« ç´ æidea!</p>

<p>æœ€å¾Œï¼Œä¾†è¤‡ç¿’ä¸€ä¸‹æ˜¨å¤©çš„è®Šæ•¸æ¯”ä¸€æ¯”ï¼å‰›å¥½åœ¨ä»Šå¤©çš„ä¾‹å­<code class="highlighter-rouge">class_eval</code>ã€<code class="highlighter-rouge">instance_eval</code>ï¼Œé¡åˆ¥å¯¦é«”è®Šæ•¸å’Œå¯¦é«”è®Šæ•¸éƒ½æœ‰æ´¾ä¸Šç”¨å ´ï¼šï¼‰</p>

<table>
  <thead>
    <tr>
      <th>é¡åˆ¥å¯¦é«”è®Šæ•¸ class instance variable</th>
      <th>å¯¦é«”è®Šæ•¸ instance variable</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>@é¡åˆ¥å¯¦é«”è®Šæ•¸</td>
      <td>@å¯¦é«”è®Šæ•¸</td>
    </tr>
    <tr>
      <td>å¯ç”¨attr_accessorçš„æ–¹å¼æ”¹å¯«</td>
      <td>å¯ç”¨attr_accessorçš„æ–¹å¼æ”¹å¯«</td>
    </tr>
    <tr>
      <td>ç”¨åœ¨é¡åˆ¥æ–¹æ³•ï¼Œä¸å¯ç”¨åœ¨å¯¦é«”æ–¹æ³•</td>
      <td>ç”¨åœ¨å¯¦é«”æ–¹æ³•</td>
    </tr>
  </tbody>
</table>

<p>ä¹Ÿè¨±é€™å°±æ˜¯ä¸€ç¨®ã€Œéå»æ¯å¤©ç´¯ç©çš„åŠªåŠ›ï¼Œæˆå°±ç¾åœ¨çš„è‡ªå·±ã€æœ€ä½³çš„ä¾‹å­å§ï¼</p>

<p>===</p>

<p>Refï¼š</p>

<ul>
  <li><a href="https://coderwall.com/p/yycytw/ruby-on-rails-interview-questions">Ruby on Rails Interview questions</a></li>
  <li><a href="https://blog.hothero.org/2015/08/05/instance-eval-yu--class-eval-chai-yi-/">instance_eval èˆ‡ class_eval å·®ç•°</a></li>
  <li><a href="http://web.stanford.edu/~ouster/cgi-bin/cs142-winter15/classEval.php">Understanding class_eval and instance_eval</a></li>
  <li><a href="http://ruby-doc.org/core-2.5.1/Module.html#method-i-class_eval">Ruby-doc.org : class_eval (Module)</a></li>
  <li><a href="http://ruby-doc.org/core-2.5.1/BasicObject.html#method-i-instance_eval">Ruby-doc.org : instance_eval (BasicObject)</a></li>
</ul>

  </div><a class="u-url" href="/ruby/interview/2018/09/22/day13_ruby_interview_questions_class_instance_eval.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Ting&#39;s Square.</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Ting&#39;s Square.</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/tingtinghsu"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">tingtinghsu</span></a></li><li><a href="https://www.twitter.com/tingtingtour"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">tingtingtour</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Copyright Ting Ting Hsu</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
