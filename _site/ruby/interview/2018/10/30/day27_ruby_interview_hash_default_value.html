<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>30天修煉Ruby面試精選30題 - Day27 Ruby裡的Hash預設值 | Ting’s Square.</title>
<meta name="generator" content="Jekyll v3.8.4" />
<meta property="og:title" content="30天修煉Ruby面試精選30題 - Day27 Ruby裡的Hash預設值" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Ruby經典面試題目 #27" />
<meta property="og:description" content="Ruby經典面試題目 #27" />
<link rel="canonical" href="http://localhost:4000/ruby/interview/2018/10/30/day27_ruby_interview_hash_default_value.html" />
<meta property="og:url" content="http://localhost:4000/ruby/interview/2018/10/30/day27_ruby_interview_hash_default_value.html" />
<meta property="og:site_name" content="Ting’s Square." />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-10-30T19:58:00+09:00" />
<script type="application/ld+json">
{"description":"Ruby經典面試題目 #27","@type":"BlogPosting","url":"http://localhost:4000/ruby/interview/2018/10/30/day27_ruby_interview_hash_default_value.html","headline":"30天修煉Ruby面試精選30題 - Day27 Ruby裡的Hash預設值","dateModified":"2018-10-30T19:58:00+09:00","datePublished":"2018-10-30T19:58:00+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/ruby/interview/2018/10/30/day27_ruby_interview_hash_default_value.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Ting's Square." /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Ting&#39;s Square.</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">30天修煉Ruby面試精選30題 - Day27 Ruby裡的Hash預設值</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2018-10-30T19:58:00+09:00" itemprop="datePublished">Oct 30, 2018
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h1 id="ruby經典面試題目-27">Ruby經典面試題目 #27</h1>

<p><code class="highlighter-rouge">Day27 Ruby的Hash預設值 How to set default value in hash?</code></p>

<p>在<a href="https://ithelp.ithome.com.tw/articles/10202250">第14天</a>的時候，我們曾經提到<code class="highlighter-rouge">Hash(雜湊)</code>是一對<code class="highlighter-rouge">key(鍵)</code>與<code class="highlighter-rouge">value(值)</code>的集合。今天的大哉問是，我們要如何設定預設值呢？</p>

<p>沒錯！起手式就是來翻閱<a href="http://ruby-doc.org/core-2.4.2/Hash.html#method-c-new">Ruby API手冊</a>看看裡面的例子，並依照我自己的喜好，改寫成容易被我記憶學習的變數。</p>

<h1 id="hash-與-array">Hash 與 Array</h1>

<p>記得我在<a href="https://ithelp.ithome.com.tw/articles/10202250">第14天</a>使用過銀行帳戶的例子，在這裡繼續沿用類似的情境。假設我創建一個hash記錄我的銀行帳戶名稱和存款金額:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hbank</span> <span class="o">=</span> <span class="no">Hash</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"Bank Name"</span><span class="p">)</span>
<span class="n">hbank</span><span class="p">[</span><span class="s2">"CAN"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">hbank</span><span class="p">[</span><span class="s2">"NAB"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span>

<span class="nb">p</span> <span class="n">hbank</span><span class="p">.</span><span class="nf">keys</span> <span class="c1">#=&gt; 銀行名["CAN", "NAB"]</span>
<span class="nb">p</span> <span class="n">hbank</span><span class="p">.</span><span class="nf">values</span> <span class="c1">#=&gt; 存款金額[100, 200]</span>

<span class="nb">p</span> <span class="n">hbank</span><span class="p">[</span><span class="s2">"CAN"</span><span class="p">]</span>  <span class="c1">#=&gt; 100</span>
<span class="nb">p</span> <span class="n">hbank</span><span class="p">[</span><span class="s2">"NAB"</span><span class="p">]</span> <span class="c1">#=&gt; 200</span>
</code></pre></div></div>

<p>如果我要查閱某個並沒有在此Hash的銀行名稱呢？</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">p</span> <span class="n">hbank</span><span class="p">[</span><span class="s2">"WEST"</span><span class="p">]</span>           <span class="c1">#=&gt; "Bank Name"</span>
</code></pre></div></div>

<p>它會出現預設值`Bank Name。</p>

<p>如果你以為這題面試題這麼簡單，那就大錯特錯了！（<del>不要來～污辱我的美</del>）我們必須深入探討另一個常見實務場景：如何改動Hash裡的值呢？</p>

<p>你或許會想到：使用<code class="highlighter-rouge">method</code>!趕快搬出常見的字串方法使一使：</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">p</span> <span class="n">hbank</span><span class="p">[</span><span class="s2">"WEST"</span><span class="p">]</span>           <span class="c1">#=&gt; "Bank Name"</span>
<span class="nb">p</span> <span class="n">hbank</span><span class="p">[</span><span class="s2">"WEST"</span><span class="p">].</span><span class="nf">upcase!</span>   <span class="c1">#=&gt; "BANK NAME"</span>
<span class="nb">p</span> <span class="n">hbank</span><span class="p">[</span><span class="s2">"WEST"</span><span class="p">]</span>           <span class="c1">#=&gt; "BANK NAME"</span>
</code></pre></div></div>

<p><a href="https://ithelp.ithome.com.tw/articles/10202250">第14天</a>講過：</p>

<blockquote>
  <p>加上!驚嘆號的方法，通常代表小心！注意！的意思。<code class="highlighter-rouge">Array#.map!</code>方法會讓原本的物件陣列值被改變！</p>
</blockquote>

<p>因此這裡的 <code class="highlighter-rouge">string#.upcase!</code>就讓Hash裡的<code class="highlighter-rouge">Bank Name</code>硬生生地變成<code class="highlighter-rouge">BANK NAME</code>了。因此，我們了解到<code class="highlighter-rouge">陣列</code>是個<code class="highlighter-rouge">可變的</code>物件。（Array in Ruby is mutable object）</p>

<h1 id="hash-與-block">Hash 與 Block</h1>

<p>要預設Hash，我們還必須複習<a href="https://ithelp.ithome.com.tw/articles/10201297">第11天</a>的<code class="highlighter-rouge">block(區塊)</code>，因為Hash和block有密不可分的關係！</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hbank_key</span> <span class="o">=</span> <span class="no">Hash</span><span class="p">.</span><span class="nf">new</span> <span class="p">{</span> <span class="o">|</span><span class="nb">hash</span><span class="p">,</span><span class="nb">name</span><span class="o">|</span> <span class="nb">hash</span><span class="p">[</span><span class="nb">name</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Bank Name: </span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">"</span> <span class="p">}</span>

<span class="nb">p</span> <span class="n">hbank_key</span><span class="p">[</span><span class="s2">"ANZ"</span><span class="p">]</span>           <span class="c1">#=&gt; "Bank Name: ANZ"</span>
<span class="nb">p</span> <span class="n">hbank_key</span><span class="p">[</span><span class="s2">"ANZ"</span><span class="p">].</span><span class="nf">upcase!</span>   <span class="c1">#=&gt; "BANK NAME: ANZ"</span>
<span class="nb">p</span> <span class="n">hbank_key</span><span class="p">[</span><span class="s2">"ANZ"</span><span class="p">]</span>
<span class="c1">#=&gt; "BANK NAME: ANZ" 變大寫了</span>
<span class="nb">p</span> <span class="n">hbank_key</span><span class="p">[</span><span class="s2">"CBA"</span><span class="p">]</span>           <span class="c1">#=&gt; "Bank Name: CBA" 還是小寫</span>
<span class="nb">p</span> <span class="n">hbank_key</span><span class="p">.</span><span class="nf">keys</span>           <span class="c1">#=&gt; ["ANZ", "CBA"]</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">hbank_key</code>這個雜湊的例子比第一個版本<code class="highlighter-rouge">hbank</code>稍微進步，讓<code class="highlighter-rouge">hbank_key["CBA"]</code>的‘值並不會因為<code class="highlighter-rouge">hbank_key["ANZ"].upcase!</code>作怪，而受到影響。</p>

<p><a href="https://stackoverflow.com/questions/2698460/strange-unexpected-behavior-disappearing-changing-values-when-using-hash-defa">Stackovrflow 原文</a>這句話解釋的很清楚：</p>

<blockquote>
  <p>It is the block’s responsibility to store the value in the hash if required.</p>
</blockquote>

<h1 id="hash-與-結合比較">Hash <code class="highlighter-rouge">&lt;&lt;</code>與 <code class="highlighter-rouge">+=</code>結合比較</h1>

<p>如果我們<del>硬要唱反調</del>，讓Hash設定default value時不使用block，看會發生什麼情況？</p>

<h2 id="1-hash-用-指定值">1. hash: 用 « 指定值</h2>

<p>我們在<a href="https://ithelp.ithome.com.tw/articles/10203332">第17天</a>已了解到：<code class="highlighter-rouge">&lt;&lt; 會改變常數</code>，因此<code class="highlighter-rouge">hsh_array[:z]</code>被指定了新值。</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hsh_array</span> <span class="o">=</span> <span class="no">Hash</span><span class="p">.</span><span class="nf">new</span><span class="p">([])</span>
<span class="nb">p</span> <span class="n">hsh_array</span> <span class="c1"># =&gt; {} 預設是空hash</span>
<span class="n">hsh_array</span><span class="p">[</span><span class="ss">:a</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s1">'This is symbol a'</span>
<span class="n">hsh_array</span><span class="p">[</span><span class="ss">:b</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s1">'This is symblo b'</span>

<span class="nb">p</span> <span class="n">hsh_array</span><span class="p">[</span><span class="ss">:z</span><span class="p">]</span>
<span class="c1"># =&gt; ["This is symbol a", "This is symblo b"]</span>

<span class="nb">p</span> <span class="n">hsh_array</span> <span class="c1"># =&gt; {} hash不變，仍是空hash</span>
</code></pre></div></div>

<h2 id="2-hash-block-與-">2. hash, block 與 «</h2>

<p>例子1 在<code class="highlighter-rouge">Hash</code>內使用<code class="highlighter-rouge">&lt;&lt;</code>指定值時(the assignment way)，<code class="highlighter-rouge">hsh_array[:z]</code>原本預設為[]，卻受到[:a]與[:b]的改變而影響：那改成<code class="highlighter-rouge">&lt;&lt;</code>(the mutable way)呢？</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hsh_block</span> <span class="o">=</span> <span class="no">Hash</span><span class="p">.</span><span class="nf">new</span> <span class="p">{</span> <span class="o">|</span><span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="o">|</span> <span class="n">h</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span> <span class="p">}</span>

<span class="nb">p</span> <span class="n">hsh_block</span><span class="p">[</span><span class="ss">:a</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s1">'This is symbol a'</span>  <span class="c1">#=&gt; ["a"]</span>
<span class="nb">p</span> <span class="n">hsh_block</span><span class="p">[</span><span class="ss">:b</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s1">'This is symblo b'</span>  <span class="c1">#=&gt; ["b"]</span>

<span class="nb">p</span> <span class="n">hsh_block</span><span class="p">[</span><span class="ss">:z</span><span class="p">]</span> <span class="c1">#[]</span>
<span class="nb">p</span> <span class="n">hsh_block</span>            <span class="c1">#=&gt; {:a=&gt;["This is symbol a"], :b=&gt;["This is symblo b"], :z=&gt;[]}</span>
</code></pre></div></div>

<h2 id="3-hash-用--改變值">3. hash: 用 += 改變值</h2>

<p>關於串接字串，來複習一下<a href="https://ithelp.ithome.com.tw/articles/10200836">第8天</a>的<code class="highlighter-rouge">+=</code>是<code class="highlighter-rouge">mutable</code>的方法，其<code class="highlighter-rouge">object_id</code>會隨著新串接上的字串，而改變記憶體位置。</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hsh_plus</span> <span class="o">=</span> <span class="no">Hash</span><span class="p">.</span><span class="nf">new</span><span class="p">([])</span>
<span class="nb">p</span> <span class="n">hsh_plus</span>  <span class="c1"># =&gt; {} 預設是空hash</span>
<span class="nb">p</span> <span class="n">hsh_plus</span><span class="p">[</span><span class="ss">:a</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">'This is symbol a'</span><span class="p">]</span>
<span class="nb">p</span> <span class="n">hsh_plus</span><span class="p">[</span><span class="ss">:b</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">'This is symblo b'</span><span class="p">]</span>

<span class="nb">p</span> <span class="n">hsh_plus</span><span class="p">[</span><span class="ss">:z</span><span class="p">]</span>
<span class="c1"># =&gt; [] 空array</span>

<span class="nb">p</span> <span class="n">hsh_plus</span>
<span class="c1"># {:a=&gt;["This is symbol a"], :b=&gt;["This is symblo b"]}</span>
<span class="c1"># hash is mutable&lt; 預設值已被改變</span>
</code></pre></div></div>

<h2 id="4-hash-用--與-freeze-固定值">4. hash: 用 += 與 <code class="highlighter-rouge">freeze?</code> 固定值</h2>

<p>最後，如果要讓hash的<code class="highlighter-rouge">+=</code>不透過block的作用也能變成<code class="highlighter-rouge">imutable</code>，我們就要來複習<a href="https://ithelp.ithome.com.tw/articles/10203332">Day17</a>的<code class="highlighter-rouge">freeze?</code>方法：</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hsh_freeze</span> <span class="o">=</span> <span class="no">Hash</span><span class="p">.</span><span class="nf">new</span><span class="p">([].</span><span class="nf">freeze</span><span class="p">)</span>
<span class="nb">p</span> <span class="n">hsh_freeze</span><span class="p">[</span><span class="ss">:a</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">'This is symbol a'</span><span class="p">]</span>  <span class="c1">#=&gt; ["This is symbol a"]</span>
<span class="nb">p</span> <span class="n">hsh_freeze</span><span class="p">[</span><span class="ss">:b</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">'This is symbol b'</span><span class="p">]</span>   <span class="c1">#=&gt; ["This is symbol b"]</span>
<span class="nb">p</span> <span class="n">hsh_freeze</span><span class="p">[</span><span class="ss">:z</span><span class="p">]</span>           <span class="c1">#=&gt; [] #=&gt; hash值不受更動，仍為空</span>
<span class="nb">p</span> <span class="n">hsh_freeze</span>              <span class="c1">#=&gt; {:a=&gt;["This is symbol a"], :b=&gt;["This is symbol b"]}</span>
</code></pre></div></div>

<p>結論：</p>

<p>看完幾篇文章，發現有寫工程師偏好不要變動預設變數、但也有些人偏好能夠更彈性的變動變數，端看個人開發習慣。不過寫完落落長的比較，這個結論你一定要熟記喔！</p>

<blockquote>
  <p>We must store the default value in the <code class="highlighter-rouge">hash</code> from within the <code class="highlighter-rouge">block</code> if we wish to use <code class="highlighter-rouge">&lt;&lt;</code> instead of <code class="highlighter-rouge">&lt;&lt;=</code>
</p>
</blockquote>

<p>Ref:</p>

<ul>
  <li><a href="https://devblast.com/b/ruby-tricks-improve-code">10 Ruby tricks to improve your code</a></li>
  <li><a href="https://stackoverflow.com/questions/16159370/ruby-hash-default-value-behavior">Ruby hash default value behavior</a></li>
  <li><a href="https://stackoverflow.com/questions/2698460/strange-unexpected-behavior-disappearing-changing-values-when-using-hash-defa">Strange, unexpected behavior (disappearing/changing values) when using Hash default value, e.g. Hash.new([])</a></li>
  <li><a href="http://ruby-doc.org/core-2.4.2/Hash.html#method-c-new">Ruby API: Hash.new</a></li>
</ul>

  </div><a class="u-url" href="/ruby/interview/2018/10/30/day27_ruby_interview_hash_default_value.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Ting&#39;s Square.</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Ting&#39;s Square.</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/tingtinghsu"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">tingtinghsu</span></a></li><li><a href="https://www.twitter.com/tingtingtour"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">tingtingtour</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Copyright Ting Ting Hsu</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
